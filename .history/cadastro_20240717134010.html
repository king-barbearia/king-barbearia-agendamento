<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <style>
      .file-input-container {
        position: relative;
        display: inline-block;
      }

      .file-input {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
        cursor: pointer;
      }

      .custom-file-button {
        font-size: 10px;
      }
    </style>
    <title>Cadastro De Usuarios</title>
  </head>
  <body>
    <header>
      <img
        class="header-image"
        src="./images/kinkbarbearia-removebg-preview.png"
        alt=""
      />
    </header>
    <div id="name">
      <h1>King Barbearia</h1>
      <div id="midiasocial">
        <img
          class="icon"
          id="compartilhar"
          src="./images/compartilhar.png"
          alt="compartilhar"
        />
        <img class="icon" id="curtir" src="./images/coracao.png" alt="curtir" />
      </div>
      <p>Estrada das Lagrimas 1249, 04232-000, São Paulo</p>
      <div class="menu">
        <nav>
          <div class="menu-toggle" id="mobile-menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
          </div>
          <ul class="nav-list">
            <li>
              <a
                href="#"
                class="active"
                onclick="toggleSection(event, 'services')"
                >Serviços</a
              >
            </li>
            <li>
              <a href="#" onclick="toggleSection(event, 'evaluation')"
                >Avaliação</a
              >
            </li>
            <li>
              <a
                href="#"
                id="portfolio-link"
                onclick="toggleSection(event, 'portfolio')"
                >Portfolio</a
              >
            </li>
            <li>
              <a
                href="#"
                id="detalhes-link"
                onclick="toggleSection(event, 'detalhes')"
                >Detalhes</a
              >
            </li>
            <li>
              <a
                href="#"
                id="agenda-link"
                onclick="toggleSection(event, 'agenda')"
                >Agendamentos</a
              >
            </li>
          </ul>
        </nav>
      </div>
    </div>
    <div id="register-form">
      <div class="cadastro">
        <img
          id="foto-preview"
          src="./images/kinkbarbearia-removebg-preview.png"
          alt="Imagem de Pré-visualização"
        />
        <div class="file-input-container">
          <button
            class="custom-file-button"
            style="
              width: 75px;
              height: 17px;
              position: absolute;
              margin: -98px -133px;
              color: #bdbdbd;
              background-color: #232323;
            "
          >
            Adicionar Foto
          </button>
          <input
            type="file"
            id="file-input"
            class="file-input"
            accept="image/*"
          />
        </div>
        <span>Nome</span>
        <input
          type="text"
          id="name-input"
          class="nome"
          placeholder="Digite Seu Nome"
        />
        <span>Telefone</span>
        <input
          type="text"
          id="phone-input"
          class="whatsapp"
          placeholder="WhatsApp"
        />
        <span>Email</span>
        <input
          type="text"
          id="email-input"
          class="email"
          placeholder="Digite Seu Email"
        />
        <button type="button" class="confirmar-cds" onclick="registerUser()">
          Cadastrar
        </button>
      </div>
    </div>
    <footer></footer>
    <script>
      document.getElementById("curtir").addEventListener("click", function () {
        if (this.src.includes("coracao.png")) {
          this.src = "./images/coracaopreenchido.png";
        } else {
          this.src = "./images/coracao.png";
        }
      });

      // Função para formatar o número de telefone
      function formatPhoneNumber(event) {
        let input = event.target.value.replace(/\D/g, "");
        if (input.length > 11) input = input.substring(0, 11);

        let formattedNumber = "";
        if (input.length > 0) formattedNumber += "(" + input.substring(0, 2);
        if (input.length > 2) formattedNumber += ") " + input.substring(2, 7);
        if (input.length > 7) formattedNumber += "-" + input.substring(7, 11);

        event.target.value = formattedNumber;
      }

      document
        .querySelector(".whatsapp")
        .addEventListener("input", formatPhoneNumber);

      // Função para pré-visualizar a imagem selecionada
      document
        .getElementById("file-input")
        .addEventListener("change", function (event) {
          const file = event.target.files[0];
          if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
              document.getElementById("foto-preview").src = e.target.result;
            };
            reader.readAsDataURL(file);
          }
        });

      // Ativar o input file quando o botão estilizado é clicado
      document
        .querySelector(".custom-file-button")
        .addEventListener("click", function () {
          document.getElementById("file-input").click();
        });

      // Função para registrar o usuário
      function registerUser() {
        const name = document.getElementById("name-input").value;
        const phone = document.getElementById("phone-input").value;
        const email = document.getElementById("email-input").value;
        const photo = document.getElementById("file-input").files[0];

        // Constrói o objeto FormData para enviar os dados
        const formData = new FormData();
        formData.append("name", name);
        formData.append("phone", phone);
        formData.append("email", email);
        formData.append("photo", photo);

        // Realiza a requisição POST usando fetch
        fetch("/register", {
          method: "POST",
          body: formData,
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error("Erro ao cadastrar usuário");
            }
            return response.json();
          })
          .then((data) => {
            alert(data.message); // Exibe a mensagem de retorno
            // Limpar os campos do formulário após o cadastro bem-sucedido
            document.getElementById("name-input").value = "";
            document.getElementById("phone-input").value = "";
            document.getElementById("email-input").value = "";
            document.getElementById("foto-preview").src =
              "./images/kinkbarbearia-removebg-preview.png";
          })
          .catch((error) => {
            console.error("Erro:", error);
            alert("Erro ao cadastrar usuário");
          });
      }
    </script>
  </body>
</html>
