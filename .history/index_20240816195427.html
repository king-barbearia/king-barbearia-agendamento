<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="mobile.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />

    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <title>Home</title>
  </head>
  <body>
    <header>
      <img
        class="header-image"
        src="./images/kinkbarbearia-removebg-preview.png"
        alt=""
      />
    </header>
    <div id="name">
      <h1>King Barbearia</h1>
      <div id="midiasocial">
        <img
          class="icon"
          id="compartilhar"
          src="./images/compartilhar.png"
          alt="compartilhar"
        />
        <img class="icon" id="curtir" src="./images/coracao.png" alt="curtir" />
      </div>
      <p>
        Estrada das Lagrimas 1249, 04232-000,<br />
        São Paulo Heliopolis.
      </p>
    </div>
    <div class="menu">
      <nav>
        <div class="menu-toggle" id="mobile-menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
        <ul class="nav-list">
          <li>
            <a
              href="#"
              class="active"
              onclick="toggleSection(event, 'services')"
              >Serviços</a
            >
          </li>
          <li>
            <a href="#" onclick="toggleSection(event, 'evaluation')">
              Avaliação</a
            >
          </li>
          <li>
            <a
              href="#"
              id="portfolio-link"
              onclick="toggleSection(event, 'portfolio')"
              >Portfolio</a
            >
          </li>
          <li>
            <a
              href="#"
              id="detalhes-link"
              onclick="toggleSection(event, 'detalhes')"
              >Detalhes</a
            >
          </li>
          <li>
            <a href="./agenda.html" id="agenda-link">Agendamentos</a>
          </li>
        </ul>
      </nav>
    </div>
    <div id="services" style="display: none">
      <!-- <p>Serviços</p> -->
      <div id="corte">
        <h2>Corte</h2>
        <span style="font-size: 12px">Corte Simples</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 30,00</strong></span>
          <span id="tempo" data-duration="45">45m</span>
          <button id="agendar-btn" data-servico="Corte Simples">Agendar</button>
        </div>
      </div>
      <div id="barba">
        <h2>Barba</h2>
        <span style="font-size: 12px">Barba Simples</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 30,00</strong></span>
          <span id="tempo" data-duration="40">40m</span>
          <button id="agendar-btn" data-servico="Barba">Agendar</button>
        </div>
      </div>
      <div id="pezinho">
        <h2>Pezinho</h2>
        <span style="font-size: 12px">Pezinho</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 15,00</strong></span>
          <span id="tempo" data-duration="15">15m</span>
          <button id="agendar-btn" data-servico="Pezinho">Agendar</button>
        </div>
      </div>
      <div id="cortebarba">
        <h2>Corte + Barba</h2>
        <span style="font-size: 12px">Corte E Barba</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 50,00</strong></span>
          <span id="tempo" data-duration="50">50m</span>
          <button id="agendar-btn" data-servico="Corte + Barba">Agendar</button>
        </div>
      </div>
      <div id="cortesobrancelha">
        <h2>Corte + Sobrancelha</h2>
        <span style="font-size: 12px">Corte E Sobrancelha</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 35,00</strong></span>
          <span id="tempo" data-duration="50">50m</span>
          <button id="agendar-btn" data-servico="Corte + Sobrancelha">
            Agendar
          </button>
        </div>
      </div>
      <div id="mascarafacil">
        <h2>Máscara Facil</h2>
        <span style="font-size: 12px">Máscara Facil</span>
        <div id="agendar">
          <span id="valor"><strong id="mascarafacil">R$ 15,00</strong></span>
          <span id="tempo" data-duration="15">15m</span>
          <button id="agendar-btn" data-servico="Mascara Facil">Agendar</button>
        </div>
      </div>
      <div id="hidradacao">
        <h2>Hidradação</h2>
        <span style="font-size: 12px">Hidradação</span>
        <div id="agendar">
          <span id="valor"><strong id="mascarafacil">R$ 15,00</strong></span>
          <span id="tempo" data-duration="15">15m</span>
          <button id="agendar-btn" data-servico="Hidradação">Agendar</button>
        </div>
      </div>
      <div id="luzes">
        <h2>Luzes</h2>
        <span style="font-size: 12px">Luzes</span>
        <div id="agendar">
          <span id="valor"><strong id="luzes">R$ 90,00</strong></span>
          <span id="tempo" data-duration="90">1h30</span>
          <button id="agendar-btn" data-servico="Luzes">Agendar</button>
        </div>
      </div>
    </div>
    <!-- Modal for Scheduling -->
    <div id="scheduleModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <img
          src="./images/kinkbarbearia-removebg-preview.png"
          alt=""
          style="
            width: 60px;
            height: 60px;
            margin-left: -219px;
            margin-top: -12px;
          "
        />
        <form id="scheduleForm">
          <input type="hidden" name="service" />
          <input type="hidden" name="value" />
          <input type="hidden" id="time-input" name="time" value="" />
          <!-- Campo de tempo -->
          <input type="hidden" id="selectedTimeField" name="selectedTime" />

          <input type="hidden" id="duration" name="duration" value="" />
          <input type="hidden" name="valueservice" />
          <label>Data</label>
          <input
            type="text"
            name="date"
            id="userDateField"
            placeholder="Escolha a Data"
            required
          />
          <div id="slc-barber">
            <label>Escolha o Barbeiro</label>
            <select
              id="barber"
              name="barber"
              style="
                border: solid 1px #bdbdbd;
                border-radius: 5px;
                padding: 5px;
                font-size: 15px;
                font-weight: 600;
              "
              required
            >
              <option value="" disabled selected>Selecione um barbeiro</option>
              <option value="Wallace">Wallace</option>
              <option value="Mateus">Mateus</option>
            </select>
          </div>

          <label>Nome Do Cliente</label>
          <input
            type="text"
            name="name"
            id="userNameField"
            placeholder="Digite Seu Nome"
            required
            autocomplete="name"
          />
          <label>WhatsApp</label>
          <input
            type="text"
            name="phone"
            id="userPhoneField"
            placeholder="Digite Seu Whatsapp"
            required
            autocomplete="tel"
          />

          <button id="submit-form">Agendar</button>
        </form>
      </div>
    </div>
    <div id="availabilityModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close" onclick="closeAvailabilityModal()">&times;</span>
        <h3>Horários Disponíveis</h3>

        <ul id="availableTimesList" style="list-style-type: none; padding: 0">
          <!-- Os horários serão inseridos aqui dinamicamente -->
        </ul>
        <!-- <button onclick="selectTime()">Selecionar Horário</button> -->
      </div>
    </div>

    <!-- Update Agenda Section -->
    <div id="agenda" style="display: none">
      <img
        src="./images/kinkbarbearia-removebg-preview.png"
        alt=""
        style="width: 60px; margin: 10px 13px; position: absolute"
      />
      <div id="bookings"></div>
      <button id="fetchbookings" onclick="fetchBookings()">
        Mostrar Agendamentos
      </button>
    </div>

    <div id="portfolio" style="display: none">
      <div id="foto1">
        <img src="./images/foto1.jpg" alt="" />
      </div>
      <div id="foto2">
        <img src="./images/foto2.jpg" alt="" />
      </div>
      <div id="foto3">
        <img src="./images/foto3.jpg" alt="" />
      </div>
      <div id="foto4">
        <img src="./images/foto4.jpg" alt="" />
      </div>
      <div id="foto5">
        <img src="./images/foto5.jpg" alt="" />
      </div>
      <div id="foto6">
        <img src="./images/foto6.jpg" alt="" />
      </div>
    </div>
    <div id="evaluation" style="display: none">
      <h1>5,0</h1>
      <div id="avaliacao">
        <img
          class="estrela"
          data-avaliacao="1"
          src="./images/estrelanota.png"
          alt=""
        />
        <img
          class="estrela"
          data-avaliacao="2"
          src="./images/estrelanota.png"
          alt=""
        />
        <img
          class="estrela"
          data-avaliacao="3"
          src="./images/estrelanota.png"
          alt=""
        />
        <img
          class="estrela"
          data-avaliacao="4"
          src="./images/estrelanota.png"
          alt=""
        />
        <img
          class="estrela"
          data-avaliacao="5"
          src="./images/estrelanota.png"
          alt=""
        />
      </div>
      <span id="ctn-avaliacao">20 Avaliações</span>
      <div id="media"></div>
      <div id="nota">
        <span class="nota"
          >5 <img class="estrelanota" src="./images/estrelanota.png" alt=""
        /></span>
        <span class="nota"
          >4 <img class="estrelanota" src="./images/estrelanota.png" alt=""
        /></span>
        <span class="nota"
          >3 <img class="estrelanota" src="./images/estrelanota.png" alt=""
        /></span>
        <span class="nota"
          >2 <img class="estrelanota" src="./images/estrelanota.png" alt=""
        /></span>
        <span class="nota"
          >1 <img class="estrelanota" src="./images/estrelanota.png" alt=""
        /></span>
        <div class="status-star">
          <div class="status-bar">
            <div
              class="status-bar-fill"
              id="status-bar-fill5"
              style="width: 80%"
            ></div>
          </div>
          <div class="status-bar">
            <div
              class="status-bar-fill"
              id="status-bar-fill4"
              style="width: 30%"
            ></div>
          </div>
          <div class="status-bar">
            <div
              class="status-bar-fill"
              id="status-bar-fill3"
              style="width: 1%"
            ></div>
          </div>
          <div class="status-bar">
            <div class="status-bar-fill" id="status-bar-fill2"></div>
          </div>
          <div class="status-bar">
            <div class="status-bar-fill" id="status-bar-fill1"></div>
          </div>
        </div>
      </div>
    </div>
    <div id="detalhes" style="display: none">
      <div id="map"></div>
      <button id="navigate-button">
        <img
          id="logobt"
          src="./images/kinkbarbearia-removebg-preview.png"
          alt=""
        />
        <h1>Kink Barbearia</h1>
        <span
          >Estrada Das Lagrimas 1249, 04232-000, São Paulo
          <div class="vertical-line"></div>
          <img id="iconnavegar" src="./images/gps.png" alt=""
        /></span>
      </button>
      <div id="horarios">
        <h1>
          <strong>Contato e Horario De Funcionamento</strong>
          <div class="horizontal-line"></div>
          <a href="https://wa.me/5511987410733" target="_blank"
            >(11) 98741-0733
            <img
              class="icon"
              id="whatsapp"
              src="./images/whatsapp.png"
              alt="whatsapp"
            />
          </a>
        </h1>
        <div class="horizontal-line"></div>
        <div class="funcionamento">
          <div id="segunda">
            <p>Segunda-Feira <br />a Sexta-Feira</p>
            <span id="horas"><strong>10:00 - 20:00</strong></span>
          </div>
          <div id="sabado">
            <p>Sabado</p>
            <span id="horas"><strong>09:00 - 19:00</strong></span>
          </div>
          <div id="domingo">
            <p>Domingo</p>
            <span id="horas"><strong>Fechado</strong></span>
          </div>
          <div id="barbeiros">
            <p>Wallace</p>
            <span id="horas"><strong>Terça-Feira Folga</strong></span>
            <p>Mateus</p>
            <span id="horas"><strong>Quarta-Feira Folga</strong></span>
          </div>
        </div>
      </div>
    </div>
    <div id="myModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Bem-vindo à King Barbearia</h2>
        <p style="color: #bdbdbd; font-weight: 500">Escolha uma opção:</p>
        <button id="loginBtn">Já sou cadastrado</button>
        <button id="registerBtn">Cadastre-se</button>
      </div>
    </div>
    <div id="sucessModal" class="modal">
      <div class="modal-content">
        <img
          src="./images/kinkbarbearia-removebg-preview.png"
          style="position: absolute; width: 60px; margin: -15px -175px"
          alt=""
        />
        <span class="sucessclose">&times;</span>
        <h2
          style="
            font-size: 18px;
            margin: -34px 0px;
            margin-left: 51px;
            text-wrap: nowrap;
            margin-bottom: 30px;
          "
        >
          Agendamento Confirmado!
        </h2>
        <p style="color: #bdbdbd; font-weight: 500; font-size: 14px">Confira</p>
        <button id="confirmBtn" href="./agenda.html">Agendamentos</button>
      </div>
    </div>
    <div id="deleteModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Confirmação de Exclusão</h2>
        <p style="color: #bdbdbd; font-weight: 500">
          Tem certeza de que deseja deletar este agendamento?
        </p>
        <button id="deleteBtn">Deletar</button>
        <button id="del-cancelBtn">Cancelar</button>
      </div>
    </div>
    <!-- Modal de sucesso de exclusão -->
    <div id="deletedModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Agendamento Deletado</h2>
        <p style="color: #bdbdbd; font-weight: 500">
          O agendamento foi deletado com sucesso.
        </p>
        <button id="successOkBtn">Ok</button>
      </div>
    </div>

    <div id="agenda" style="display: none">
      <div id="servico-selecionado"></div>
    </div>
    <footer></footer>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/pt.js"></script>
    <script src="script.js"></script>
    <script>
      document
        .getElementById("userDateField")
        .addEventListener("change", function () {
          const date = this.value;
          const barber = document.getElementById("barber").value;
          if (barber && date) {
            openAvailabilityModal();
          }
        });
    </script>
    <script>
      // Seleciona o modal
      var modal = document.getElementById("myModal");

      // Seleciona o botão de fechar
      var closeBtn = modal.querySelector(".close");

      // Seleciona os botões de login e registro
      var loginBtn = document.getElementById("loginBtn");
      var registerBtn = document.getElementById("registerBtn");

      // Mostra o modal ao carregar a página
      window.onload = function () {
        modal.style.display = "block";
      };

      // Fecha o modal ao clicar no botão de fechar
      closeBtn.onclick = function () {
        modal.style.display = "none";
      };

      // Redireciona para login.html ao clicar em "Já sou cadastrado"
      loginBtn.onclick = function () {
        window.location.href = "login.html";
      };

      // Redireciona para cadastro.html ao clicar em "Cadastre-se"
      registerBtn.onclick = function () {
        window.location.href = "cadastro.html";
      };
      var modal = document.getElementById("myModal");

      // Seleciona o botão de fechar
      var closeBtn = modal.querySelector(".close");

      // Seleciona os botões de login e registro
      var loginBtn = document.getElementById("loginBtn");
      var registerBtn = document.getElementById("registerBtn");

      // Mostra o modal ao carregar a página se o usuário não estiver logado
      window.onload = function () {
        if (!localStorage.getItem("loggedIn")) {
          modal.style.display = "block";
        } else {
          // Remove a flag para que o modal não apareça nas próximas visitas
          localStorage.removeItem("loggedIn");
        }
      };

      // Fecha o modal ao clicar no botão de fechar
      closeBtn.onclick = function () {
        modal.style.display = "none";
      };

      // Redireciona para login.html ao clicar em "Já sou cadastrado"
      loginBtn.onclick = function () {
        window.location.href = "login.html";
      };

      // Redireciona para cadastro.html ao clicar em "Cadastre-se"
      registerBtn.onclick = function () {
        window.location.href = "cadastro.html";
      };

      document.addEventListener("DOMContentLoaded", function () {
        const userLoggedIn = localStorage.getItem("loggedIn");
        if (userLoggedIn === "true") {
          const userName = localStorage.getItem("userName");
          const userPhone = localStorage.getItem("userPhone");

          const userNameField = document.getElementById("userNameField");
          const userPhoneField = document.getElementById("userPhoneField");

          console.log(`userName: ${userName}, userPhone: ${userPhone}`); // Debugging log

          if (userName && userNameField) {
            userNameField.value = userName;
          } else {
            console.log("userNameField or userName not found");
          }
          if (userPhone && userPhoneField) {
            userPhoneField.value = userPhone;
          }
        }
        document.addEventListener("DOMContentLoaded", function () {
          const userLoggedIn = localStorage.getItem("loggedIn");

          if (userLoggedIn === "true") {
            const userName = localStorage.getItem("userName");
            const userPhone = localStorage.getItem("userPhone");

            const userNameField = document.getElementById("userNameField");
            const userPhoneField = document.getElementById("userPhoneField");

            console.log(`userName: ${userName}, userPhone: ${userPhone}`); // Debugging log

            if (userName && userNameField) {
              userNameField.value = userName;
            } else {
              console.log("userNameField or userName not found");
            }
            if (userPhone && userPhoneField) {
              userPhoneField.value = userPhone;
            }

            // Esconde o modal se o usuário já estiver logado
            const modal = document.getElementById("myModal");
            if (modal) {
              modal.style.display = "none";
            }
          } else {
            // Mostra o modal se o usuário não estiver logado
            const modal = document.getElementById("myModal");
            if (modal) {
              modal.style.display = "block";
            }
          }
        });

        const agendarBtns = document.querySelectorAll("#agendar-btn");

        agendarBtns.forEach(function (btn) {
          btn.addEventListener("click", function () {
            const userName = localStorage.getItem("userName");
            const userPhone = localStorage.getItem("userPhone");

            const userNameField = document.getElementById("userNameField");
            const userPhoneField = document.getElementById("userPhoneField");

            console.log(`userName: ${userName}, userPhone: ${userPhone}`); // Debugging log

            if (userName && userNameField) {
              userNameField.value = userName;
            } else {
              console.log("userNameField or userName not found");
            }
            if (userPhone && userPhoneField) {
              userPhoneField.value = userPhone;
            }

            const scheduleModal = document.getElementById("scheduleModal");
            scheduleModal.style.display = "block";
          });
        });
      });
    </script>
    <script>
      function selectBarber(barberName) {
        document.getElementById("barber").value = barberName;
      }
    </script>
    <script>
      function fetchBookings() {
        const userName = localStorage.getItem("userName");
        const userPhone = localStorage.getItem("userPhone");

        if (!userName || !userPhone) {
          alert("User is not logged in.");
          return;
        }

        fetch(
          `http://127.0.0.1:8080/customer_bookings?name=${encodeURIComponent(
            userName
          )}&phone=${encodeURIComponent(userPhone)}`
        )
          .then((response) => response.json())
          .then((data) => {
            const bookingsContainer = document.getElementById("bookings");
            bookingsContainer.innerHTML = ""; // Limpa os agendamentos existentes

            if (Array.isArray(data) && data.length > 0) {
              data.forEach((booking) => {
                const bookingElement = document.createElement("div");
                bookingElement.innerHTML = `
                        <h3 style="margin-top: 20px;">${booking.service}</h3>
                        <p>Barbeiro: ${booking.barber}</p>
                        <p>Data: ${formatDate(booking.date)}</p>
                        <p>Horário: ${booking.time}</p>
                        <p>Duração: ${booking.duration} minutos</p>
                        <p>Valor: ${booking.valueservice}</p>
                        <img id="ex-agenda-${
                          booking.id
                        }" style="position: absolute; margin: -108px 200px; cursor: pointer;width: 35px;" src="./images/lixeira-de-reciclagem.png"></img>
                        <p style="    position: absolute;margin: -70px 193px;font-size: 14px;color: #232323;">Excluir</p>
                        `;

                // Adiciona evento de clique para a imagem de exclusão
                const deleteImage = bookingElement.querySelector(
                  `#ex-agenda-${booking.id}`
                );
                deleteImage.addEventListener("click", () => {
                  if (
                    confirm("Are you sure you want to delete this booking?")
                  ) {
                    console.log("Deleting booking with ID:", booking.id);
                    deleteBooking(booking.id); // Use o ID corretamente
                  }
                });

                bookingsContainer.appendChild(bookingElement);
              });
            } else {
              bookingsContainer.innerHTML = "<p>No bookings found.</p>";
            }
          })
          .catch((error) => {
            console.error("Error fetching bookings:", error);
          });

        function formatDate(dateString) {
          const [year, month, day] = dateString.split("-");
          return `${day}/${month}/${year}`;
        }

        // Função para excluir a reserva
        function deleteBooking(bookingId) {
          if (!bookingId) {
            console.error("No booking ID provided for deletion.");
            return;
          }
          fetch(`https://KinkBarbearia.pythonanywhere.com/customer_bookings/${bookingId}`, {
            method: "DELETE",
          })
            .then((response) => {
              if (response.ok) {
                alert("Booking deleted successfully.");
                fetchBookings();
              } else {
                alert("Failed to delete booking.");
              }
            })
            .catch((error) => {
              console.error("Error deleting booking:", error);
            });
        }
      }
    </script>
    <script>
      // Função para abrir o modal de disponibilidade de horários
      function openAvailabilityModal() {
        const barberSelect = document.getElementById("barber");
        const barber = barberSelect.value;
        const date = document.getElementById("userDateField").value;

        if (!barber || !date) {
          console.error("Barber or date is not selected");
          return;
        }

        fetch(
          `https://KinkBarbearia.pythonanywhere.com/availability?barber=${encodeURIComponent(
            barber
          )}&date=${encodeURIComponent(date)}`
        )
          .then((response) => {
            if (!response.ok) {
              throw new Error(
                `Error ${response.status}: ${response.statusText}`
              );
            }
            return response.json();
          })
          .then((data) => {
            displayAvailableTimes(data.available_times);
          })
          .catch((error) => {
            console.error("Error fetching availability:", error);
          });
      }

      // Função para exibir os horários disponíveis no modal
      // Função para exibir os horários disponíveis no modal
      function displayAvailableTimes(availableTimes) {
        const timesContainer = document.getElementById("availableTimesList");

        if (!timesContainer) {
          console.error("Times container element not found");
          return;
        }

        timesContainer.innerHTML = ""; // Limpa os horários anteriores

        if (availableTimes.length === 0) {
          timesContainer.innerHTML =
            "<p>Nenhum horário disponível para essa data.</p>";
          return;
        }

        availableTimes.forEach((time) => {
          const listItem = document.createElement("div");
          listItem.textContent = time;
          listItem.style.cursor = "pointer";
          listItem.style.color = "#232323";
          listItem.style.padding = "5px";
          listItem.style.width = "200px";
          listItem.style.height = "25px";
          listItem.style.backgroundColor = "#bdbdbd";
          listItem.style.textAlign = "center";
          listItem.style.margin = "10px auto"; // Centraliza horizontalmente e adiciona espaço entre os itens
          listItem.style.borderRadius = "12px";

          listItem.addEventListener("click", () => {
            // Atualiza o campo time-input com o horário selecionado
            document.getElementById("time-input").value = time;
            closeAvailabilityModal(); // Fechar o modal após a seleção
          });

          timesContainer.appendChild(listItem);
        });

        openModal(); // Abre o modal após carregar os horários
      }

      // Função para abrir o modal
      function openModal() {
        const modal = document.getElementById("availabilityModal");
        if (modal) {
          modal.style.display = "block";
        } else {
          console.error("Modal element not found");
        }
      }

      // Função para fechar o modal
      function closeAvailabilityModal() {
        const modal = document.getElementById("availabilityModal");
        if (modal) {
          modal.style.display = "none";
        } else {
          console.error("Modal element not found");
        }
      }

      // Adiciona um evento de submit para o formulário

      document.getElementById("barber").addEventListener("change", function () {
        const barber = this.value;
        if (barber) {
          openAvailabilityModal(); // Abre o modal de horários disponíveis
        }
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        flatpickr("#userDateField", {
          altInput: true,
          altFormat: "F j, Y",
          dateFormat: "Y-m-d",
          locale: "pt",
        });
      });
    </script>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        // Adiciona evento de clique para todos os botões de agendamento
        const agendarButtons = document.querySelectorAll("#agendar-btn");

        agendarButtons.forEach((button) => {
          button.addEventListener("click", function () {
            // Obtém o serviço, valor e duração do botão clicado
            const service = button.getAttribute("data-servico");
            const value =
              button.parentElement.querySelector("#valor strong").textContent;
            const duration = button.parentElement
              .querySelector("#tempo")
              .getAttribute("data-duration");

            // Preenche os campos ocultos do formulário
            document.querySelector(
              "#scheduleForm input[name='service']"
            ).value = service;
            document.querySelector("#scheduleForm input[name='value']").value =
              value;
            document.querySelector(
              "#scheduleForm input[name='duration']"
            ).value = duration;

            // Abre o modal de disponibilidade de horários
            openAvailabilityModal();
          });
        });

        // Adiciona o evento de submit ao formulário de agendamento
        document
          .getElementById("scheduleForm")
          .addEventListener("submit", function (event) {
            event.preventDefault();

            const form = document.getElementById("scheduleForm");
            const formData = new FormData(form);

            // Obtém e converte a duração para minutos, se necessário
            const durationElement = document.querySelector("#tempo");
            const durationString =
              durationElement.getAttribute("data-duration");
            const duration = parseInt(durationString, 10);

            formData.set("duration", duration);
            formData.set(
              "value",
              document.querySelector("#valor strong").textContent
            );

            // Preenche o campo "time" com o valor do campo time-input
            const selectedTime = document.getElementById("time-input").value;
            formData.set("time", selectedTime);

            // Envio da requisição
            fetch("https://KinkBarbearia.pythonanywhere.com/schedule", {
              method: "POST",
              body: JSON.stringify(Object.fromEntries(formData.entries())),
              headers: {
                "Content-Type": "application/json",
              },
            })
              .then((response) => {
                if (!response.ok) {
                  return response.text().then((text) => {
                    throw new Error(`Error ${response.status}: ${text}`);
                  });
                }
                return response.json();
              })
              .then((data) => {
                console.log("Booking confirmed:", data.message);
              })
              .catch((error) => {
                console.error("Error:", error);
              });

            console.log(
              "Dados enviados:",
              JSON.stringify(Object.fromEntries(formData.entries()))
            );
          });
      });
    </script>
    <script>
      document
        .getElementById("submit-form")
        .addEventListener("click", function () {
          // Exibe o modal
          document.getElementById("sucessModal").style.display = "block";

          // Função para fechar o modal quando o botão de fechar for clicado
          document
            .querySelector(".sucessclose")
            .addEventListener("click", function () {
              document.getElementById("sucessModal").style.display = "none";
            });

          // Alternativa para fechar o modal se o usuário clicar fora dele (opcional)
          window.addEventListener("click", function (event) {
            if (event.target === document.getElementById("sucessModal")) {
              document.getElementById("sucessModal").style.display = "none";
            }
          });
        });
    </script>
    <script>
      document
        .getElementById("confirmBtn")
        .addEventListener("click", function () {
          window.location.href = "./agenda.html";
        });
    </script>
    <script>
      flatpickr("#userDateField", {
        disableMobile: true, // força o uso do flatpickr em dispositivos móveis
      });
    </script>
  </body>
</html>
