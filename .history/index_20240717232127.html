<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <title>Home</title>
  </head>
  <body>
    <header>
      <img
        class="header-image"
        src="./images/kinkbarbearia-removebg-preview.png"
        alt=""
      />
    </header>
    <div id="name">
      <h1>King Barbearia</h1>
      <div id="midiasocial">
        <img
          class="icon"
          id="compartilhar"
          src="./images/compartilhar.png"
          alt="compartilhar"
        />
        <img class="icon" id="curtir" src="./images/coracao.png" alt="curtir" />
      </div>
      <p>Estrada das Lagrimas 1249, 04232-000, São Paulo</p>
    </div>
    <div class="menu">
      <nav>
        <div class="menu-toggle" id="mobile-menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
        <ul class="nav-list">
          <li>
            <a
              href="#"
              class="active"
              onclick="toggleSection(event, 'services')"
              >Serviços</a
            >
          </li>
          <li>
            <a href="#" onclick="toggleSection(event, 'evaluation')">
              Avaliação</a
            >
          </li>
          <li>
            <a
              href="#"
              id="portfolio-link"
              onclick="toggleSection(event, 'portfolio')"
              >Portfolio</a
            >
          </li>
          <li>
            <a
              href="#"
              id="detalhes-link"
              onclick="toggleSection(event, 'detalhes')"
              >Detalhes</a
            >
          </li>
          <li>
            <a
              href="#"
              id="agenda-link"
              onclick="toggleSection(event, 'agenda')"
              >Agendamentos</a
            >
          </li>
        </ul>
      </nav>
    </div>
    <div id="services">
      <p>Serviços</p>
      <div id="corte">
        <h2>Corte</h2>
        <span style="font-size: 12px">Corte Simples</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 30,00</strong></span>
          <span id="tempo">30m</span>
          <button id="agendar-btn" data-servico="Corte Simples">Agendar</button>
        </div>
      </div>
      <div id="barba">
        <h2>Barba</h2>
        <span style="font-size: 12px">Barba Simples</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 30,00</strong></span>
          <span id="tempo">30m</span>
          <button id="agendar-btn" data-servico="Barba">Agendar</button>
        </div>
      </div>
      <div id="pezinho">
        <h2>Pezinho</h2>
        <span style="font-size: 12px">Pezinho</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 15,00</strong></span>
          <span id="tempo">15m</span>
          <button id="agendar-btn" data-servico="Pezinho">Agendar</button>
        </div>
      </div>
      <div id="cortebarba">
        <h2>Corte + Barba</h2>
        <span style="font-size: 12px">Corte E Barba</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 50,00</strong></span>
          <span id="tempo">50m</span>
          <button id="agendar-btn" data-servico="Corte + Barba">Agendar</button>
        </div>
      </div>
      <div id="cortesobrancelha">
        <h2>Corte + Sobrancelha</h2>
        <span style="font-size: 12px">Corte E Sobrancelha</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 35,00</strong></span>
          <span id="tempo">45m</span>
          <button id="agendar-btn" data-servico="Corte + Sobrancelha">
            Agendar
          </button>
        </div>
      </div>
      <div id="cortebs">
        <h2>Corte + Sobrancelha + Barba</h2>
        <span style="font-size: 12px">Corte Sobrancelha E Barba</span>
        <div id="agendar">
          <span id="valor"><strong>R$ 55,00</strong></span>
          <span id="tempo">60m</span>
          <button id="agendar-btn" data-servico="Corte Sombrancelha E Barba">
            Agendar
          </button>
        </div>
      </div>
      <br />
    </div>
    <!-- Modal for Scheduling -->
    <div id="scheduleModal" class="modal" style="display: none">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Agendar Serviço</h2>
        <form id="scheduleForm" onsubmit="submitForm(event)">
          <input type="hidden" name="service" />
          <input type="hidden" name="value" />
          <input type="hidden" name="time" />
          <input type="hidden" name="duration" />
          <input type="hidden" name="valueservice" />
          <input
            type="text"
            id="userNameField"
            placeholder="Digite Seu Nome"
            required
          />
          <input
            type="text"
            name="phone"
            id="userPhoneField"
            placeholder="Digite Seu Whatsapp"
            required
          />
          <label for="barber">Escolha o Barbeiro:</label>
          <select id="barber" name="barber" required>
            <option value="Wallace">Wallace</option>
            <option value="Mateus">Mateus</option>
          </select>
          <label for="date">Escolha a Data:</label>
          <input type="date" id="date" name="date" required lang="pt-BR" />
          <label for="time">Escolha o Horário:</label>
          <input type="time" id="time" name="time" required />
          <button type="submit" id="confirmSchedule">
            Confirmar Agendamento
          </button>
        </form>
      </div>
    </div>

    <!-- Update Agenda Section -->
    <div id="agenda" style="display: none">
      <h2>Agendamentos</h2>
      <div id="bookings"></div>
      <button onclick="fetchBookings()">Mostrar Agendamentos</button>
    </div>

    <div id="portfolio" style="display: none">
      <div id="foto1">
        <img src="./images/foto1.jpg" alt="" />
      </div>
      <div id="foto2">
        <img src="./images/foto2.jpg" alt="" />
      </div>
      <div id="foto3">
        <img src="./images/foto3.jpg" alt="" />
      </div>
      <div id="foto4">
        <img src="./images/foto4.jpg" alt="" />
      </div>
      <div id="foto5">
        <img src="./images/foto5.jpg" alt="" />
      </div>
      <div id="foto6">
        <img src="./images/foto6.jpg" alt="" />
      </div>
    </div>
    <div id="evaluation" style="display: none">
      <h1>5,0</h1>
      <div id="avaliacao">
        <img
          class="estrela"
          id="estrela"
          src="./images/estrela.jpg"
          alt="estrela"
        />
        <img
          class="estrela"
          id="estrela"
          src="./images/estrela.jpg"
          alt="estrela"
        />
        <img
          class="estrela"
          id="estrela"
          src="./images/estrela.jpg"
          alt="estrela"
        />
        <img
          class="estrela"
          id="estrela"
          src="./images/estrela.jpg"
          alt="estrela"
        />
        <img
          class="estrela"
          id="estrela"
          src="./images/estrela.jpg"
          alt="estrela"
        />
        <p>Média entre 10 avaliações</p>
      </div>
    </div>
    <div id="detalhes" style="display: none">
      <h2>Detalhes</h2>
      <p>
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Phasellus nec
        iaculis mauris, id tincidunt ex. Ut pellentesque urna a metus dictum
        pulvinar. Aenean tincidunt convallis neque, sit amet dignissim risus
        fermentum ac. Quisque non ante nisi. Donec blandit nunc a magna
        malesuada, a maximus est facilisis.
      </p>
      <p>
        Fusce pharetra tempor tellus, ac feugiat lacus sagittis et. Nam varius
        elit et magna porttitor, ac posuere augue venenatis. Mauris vehicula
        ultricies orci, id auctor lacus. Integer in diam sit amet lacus
        ultricies tempus in in metus. Quisque et risus lorem. Pellentesque ac
        faucibus ante.
      </p>
      <p>
        Maecenas vel metus condimentum, placerat purus et, tincidunt sapien. Nam
        pharetra luctus leo in efficitur. Nullam vel risus sed risus scelerisque
        vehicula. Duis varius erat et tortor accumsan laoreet. Aliquam ornare
        augue et lectus suscipit tempus. Donec scelerisque fringilla maximus.
        Nullam vel ligula sed justo dictum posuere ac ac mi. Aliquam erat
        volutpat. Nunc nec elementum ex, in vehicula metus.
      </p>
      <div id="map" style="width: 100%; height: 400px"></div>
      <script
        src="https://unpkg.com/leaflet/dist/leaflet.js"
        crossorigin=""
      ></script>
      <script>
        var map = L.map("map").setView([-23.622897, -46.577133], 13);
        L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
          attribution:
            '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
        }).addTo(map);
        L.marker([-23.622897, -46.577133])
          .addTo(map)
          .bindPopup("King Barbearia")
          .openPopup();
      </script>
    </div>
    <footer>
      <p>King Barbearia &copy; 2023</p>
    </footer>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        autocompleteUserDetails();
      });

      function toggleSection(event, sectionId) {
        event.preventDefault();
        var sections = [
          "services",
          "evaluation",
          "portfolio",
          "detalhes",
          "agenda",
        ];
        sections.forEach(function (section) {
          document.getElementById(section).style.display = "none";
        });
        document.getElementById(sectionId).style.display = "block";
      }

      document.querySelectorAll("#agendar-btn").forEach(function (button) {
        button.addEventListener("click", function () {
          var service = this.getAttribute("data-servico");
          openModal(service);
        });
      });

      function openModal(service) {
        document.querySelector('#scheduleModal input[name="service"]').value =
          service;
        document.getElementById("scheduleModal").style.display = "block";
        autocompleteUserDetails();
      }

      function closeModal() {
        document.getElementById("scheduleModal").style.display = "none";
      }

      function submitForm(event) {
        event.preventDefault();
        var form = event.target;
        // Store user details in localStorage
        storeUserCredentials(
          form.elements["userNameField"].value,
          form.elements["phone"].value
        );

        var data = {
          service: form.elements["service"].value,
          value: form.elements["value"].value,
          time: form.elements["time"].value,
          duration: form.elements["duration"].value,
          valueservice: form.elements["valueservice"].value,
          name: form.elements["userNameField"].value,
          phone: form.elements["phone"].value,
          barber: form.elements["barber"].value,
          date: form.elements["date"].value,
          time: form.elements["time"].value,
        };

        fetch("/api/agendamento", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        })
          .then((response) => response.json())
          .then((data) => {
            alert("Agendamento realizado com sucesso!");
            closeModal();
          })
          .catch((error) => {
            console.error("Erro ao enviar o agendamento:", error);
          });
      }

      function storeUserCredentials(name, phone) {
        localStorage.setItem("userName", name);
        localStorage.setItem("userPhone", phone);
      }

      function autocompleteUserDetails() {
        var userName = localStorage.getItem("userName");
        var userPhone = localStorage.getItem("userPhone");

        if (userName) {
          document.getElementById("userNameField").value = userName;
        }

        if (userPhone) {
          document.getElementById("userPhoneField").value = userPhone;
        }
      }

      function fetchBookings() {
        fetch("/api/agendamentos")
          .then((response) => response.json())
          .then((data) => {
            var bookingsContainer = document.getElementById("bookings");
            bookingsContainer.innerHTML = "";

            data.forEach(function (booking) {
              var bookingElement = document.createElement("div");
              bookingElement.textContent = `Serviço: ${booking.service}, Data: ${booking.date}, Horário: ${booking.time}`;
              bookingsContainer.appendChild(bookingElement);
            });
          })
          .catch((error) => {
            console.error("Erro ao buscar agendamentos:", error);
          });
      }
    </script>
  </body>
</html>
